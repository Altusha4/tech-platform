<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é</title>
  <style>
    :root { --primary: #0071e3; --bg: #f5f5f7; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
    .editor-container { max-width: 700px; margin: 40px auto; background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
    .back-link { text-decoration: none; color: var(--primary); font-weight: 500; display: inline-block; margin-bottom: 20px; }

    label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 14px; color: #333; }
    input, textarea, select {
      width: 100%; padding: 12px; margin-bottom: 20px;
      border: 1px solid #ddd; border-radius: 10px;
      font-size: 16px; box-sizing: border-box; font-family: inherit;
    }
    textarea { height: 80px; resize: none; }

    .tag-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 30px; }
    .tag-checkbox { display: none; }
    .tag-label { padding: 8px 16px; border: 1px solid #ddd; border-radius: 20px; cursor: pointer; font-size: 13px; transition: 0.2s; background: #fff; }
    .tag-checkbox:checked + .tag-label { background: var(--primary); color: white; border-color: var(--primary); }

    .publish-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

<div class="editor-container">
  <a href="/" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
  <h1>–ù–æ–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è üöÄ</h1>

  <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ (title)</label>
  <input type="text" id="post-title" placeholder="–ù–∞–ø—Ä: MongoDB Crash Course 2026">

  <label>–ö—Ä–∞—Ç–∫–æ–µ –ø—Ä–µ–≤—å—é (preview)</label>
  <input type="text" id="post-preview" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏">

  <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è (category)</label>
  <select id="post-category">
    <option value="Programming">Programming</option>
    <option value="Gadgets">Gadgets</option>
    <option value="Design">Design</option>
    <option value="Other">Other</option>
  </select>

  <label>–°—Å—ã–ª–∫–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç (body)</label>
  <input type="text" id="post-body" placeholder="URL –≤–∏–¥–µ–æ —Å YouTube –∏–ª–∏ —Ç–µ–∫—Å—Ç">

  <label>–¢–µ–≥–∏ (tags)</label>
  <div class="tag-group">
    <input type="checkbox" id="t1" class="tag-checkbox" value="mongodb"><label for="t1" class="tag-label">mongodb</label>
    <input type="checkbox" id="t2" class="tag-checkbox" value="javascript"><label for="t2" class="tag-label">javascript</label>
    <input type="checkbox" id="t3" class="tag-checkbox" value="node"><label for="t3" class="tag-label">node</label>
    <input type="checkbox" id="t4" class="tag-checkbox" value="apple"><label for="t4" class="tag-label">apple</label>
    <input type="checkbox" id="t5" class="tag-checkbox" value="iphone"><label for="t5" class="tag-label">iphone</label>
    <input type="checkbox" id="t6" class="tag-checkbox" value="tech"><label for="t6" class="tag-label">tech</label>
  </div>

  <button onclick="publish()" id="publish-btn" class="publish-btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<script>
  async function publish() {
    const title = document.getElementById('post-title').value;
    const preview = document.getElementById('post-preview').value;
    const body = document.getElementById('post-body').value;
    const category = document.getElementById('post-category').value;
    const tags = Array.from(document.querySelectorAll('.tag-checkbox:checked')).map(cb => cb.value);

    const userData = localStorage.getItem('user');
    if (!userData) return alert("–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É");
    const user = JSON.parse(userData);

    if(!title || !body) return alert("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Å—ã–ª–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã");

    const btn = document.getElementById('publish-btn');
    btn.disabled = true;
    btn.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";

    try {
      const res = await fetch('/api/content', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: "video", // –£–∫–∞–∑—ã–≤–∞–µ–º video, —á—Ç–æ–±—ã –±–∞–∑–∞ –ø—Ä–∏–Ω—è–ª–∞ –ø–æ—Å—Ç
          title,
          preview,
          body,
          category,
          tags,
          userId: user.id || user._id
        })
      });

      if (res.ok) {
        window.location.href = '/';
      } else {
        const err = await res.json();
        alert("–û—à–∏–±–∫–∞: " + err.error);
      }
    } catch (e) {
      alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
    } finally {
      btn.disabled = false;
      btn.innerText = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å";
    }
  }
</script>
</body>
</html>