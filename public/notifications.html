<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | TechPlatform</title>
  <style>
    :root { --primary: #0071e3; --bg: #f5f5f7; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #1d1d1f; }

    .notif-container { max-width: 600px; margin: 40px auto; background: white; padding: 30px; border-radius: 28px; box-shadow: 0 4px 25px rgba(0,0,0,0.05); }
    h1 { font-size: 28px; letter-spacing: -0.5px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; }

    .notif-list { display: flex; flex-direction: column; gap: 12px; }
    .notif-item {
      display: flex; align-items: center; gap: 15px; padding: 15px;
      border-radius: 18px; background: #fff; border: 1px solid #f0f0f2;
      transition: 0.2s; cursor: pointer; text-decoration: none; color: inherit;
    }
    .notif-item:hover { background: #f9f9fb; transform: translateX(5px); }
    .notif-item.unread { border-left: 4px solid var(--primary); background: #f0f7ff; }

    .notif-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; background: #eee; }
    .notif-content { flex-grow: 1; font-size: 14px; }
    .notif-content b { color: #000; }
    .notif-time { font-size: 11px; color: #86868b; margin-top: 4px; }

    .empty-state { text-align: center; padding: 50px 0; color: #86868b; }
    .back-link { text-decoration: none; color: var(--primary); font-weight: 600; font-size: 14px; }
  </style>
</head>
<body>

<div class="notif-container">
  <a href="/" class="back-link">‚Üê –í –ª–µ–Ω—Ç—É</a>
  <h1>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span id="unread-dot" style="display:none; width:10px; height:10px; background:var(--primary); border-radius:50%;"></span></h1>

  <div id="notif-list" class="notif-list">
    <p style="text-align: center; color: #888;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </div>
</div>

<script>
  const user = JSON.parse(localStorage.getItem('user'));
  const userId = user?.id || user?._id;

  async function loadNotifications() {
    if (!userId) return;
    try {
      const res = await fetch(`/api/notifications/${userId}`);
      const data = await res.json();
      const list = document.getElementById('notif-list');

      if (!data.length) {
        list.innerHTML = `<div class="empty-state">–ü–æ–∫–∞ –∑–¥–µ—Å—å —Ç–∏—à–∏–Ω–∞... ü§´</div>`;
        return;
      }

      list.innerHTML = data.map(n => {
        const actionText = n.type === 'like' ? '–ø–æ—Å—Ç–∞–≤–∏–ª(–∞) ‚ù§Ô∏è –≤–∞—à–µ–º—É –ø–æ—Å—Ç—É' : '–ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª(–∞) –≤–∞—à –ø–æ—Å—Ç üí¨';
        return `
          <a href="/post.html?id=${n.postId?._id}" class="notif-item ${n.read ? '' : 'unread'}">
            <img src="${n.sender.avatarUrl || 'https://api.dicebear.com/7.x/big-ears/svg?seed='+n.sender.username}" class="notif-avatar">
            <div class="notif-content">
              <b>${n.sender.username}</b> ${actionText}:
              <div style="color: #666; margin-top: 3px; font-style: italic;">"${n.postId?.title}"</div>
              <div class="notif-time">${new Date(n.createdAt).toLocaleString()}</div>
            </div>
          </a>
        `;
      }).join('');

      // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      fetch(`/api/notifications/read-all/${userId}`, { method: 'PUT' });
    } catch (e) {
      document.getElementById('notif-list').innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
    }
  }

  loadNotifications();
</script>
</body>
</html>